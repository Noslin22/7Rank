<!DOCTYPE html>
<html>
  <head>
    <base href="/" />
    <meta charset="UTF-8" />
    <meta content="IE=Edge" http-equiv="X-UA-Compatible" />
    <meta name="description" content="Gerenciamento de Igrejas" />

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="7Rank" />
    <link rel="apple-touch-icon" href="icons/7Rank192.png" />

    <link rel="icon" type="image/png" href="icons/7Rank512.png" />
    <link rel="icon" type="image/png" href="icons/7Rank192.png" />

    <title>7Rank</title>
    <link rel="manifest" href="manifest.json" />
  </head>
  <script src="//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.7.570/pdf.min.js"></script>
  <script type="text/javascript">
    // Link to worker for pdf.js library
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.7.570/pdf.worker.min.js";
  </script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-analytics.js"></script>
  <script type="text/javascript">
    var firebaseConfig = {
      apiKey: "AIzaSyA7dyDfFXnNGnQIxH2vI_y91tSeGRWILnA",
      authDomain: "igreja-4019a.firebaseapp.com",
      databaseURL: "https://igreja-4019a.firebaseio.com",
      projectId: "igreja-4019a",
      storageBucket: "igreja-4019a.appspot.com",
      messagingSenderId: "776069113661",
      appId: "1:776069113661:web:541360069c876b03268754",
      measurementId: "G-P1RZDCB84R",
    };
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

    var error_div = document.getElementById("error");
    document.addEventListener("DOMContentLoaded", function (event) {
      console.log("3 seg");
      firebase.auth().onAuthStateChanged(function (user) {
        if (user) {
          console.log("logado");
          var head = document.getElementsByTagName("head")[0];
          var script = document.createElement("script");

          script.setAttribute("type", "text/javascript");
          script.setAttribute("src", "main.dart.js");

          head.appendChild(js);
          error_div.style.display = "none";
          var serviceWorkerVersion = "2148643174";
          var scriptLoaded = false;
          function loadMainDartJs() {
            if (scriptLoaded) {
              return;
            }
            scriptLoaded = true;
            var scriptTag = document.createElement("script");
            scriptTag.src = "main.dart.js";
            scriptTag.type = "application/javascript";
            document.body.append(scriptTag);
          }

          if ("serviceWorker" in navigator) {
            window.addEventListener("load", function () {
              var serviceWorkerUrl =
                "flutter_service_worker.js?v=" + serviceWorkerVersion;
              navigator.serviceWorker.register(serviceWorkerUrl).then((reg) => {
                function waitForActivation(serviceWorker) {
                  serviceWorker.addEventListener("statechange", () => {
                    if (serviceWorker.state == "activated") {
                      console.log("Installed new service worker.");
                      loadMainDartJs();
                    }
                  });
                }
                if (!reg.active && (reg.installing || reg.waiting)) {
                  waitForActivation(reg.installing ?? reg.waiting);
                } else if (
                  !reg.active.scriptURL.endsWith(serviceWorkerVersion)
                ) {
                  console.log("New service worker available.");
                  reg.update();
                  waitForActivation(reg.installing);
                } else {
                  console.log("Loading app from service worker.");
                  loadMainDartJs();
                }
              });
              setTimeout(() => {
                if (!scriptLoaded) {
                  console.warn(
                    "Failed to load app from service worker. Falling back to plain <script> tag."
                  );
                  loadMainDartJs();
                }
              }, 4000);
            });
          } else {
            loadMainDartJs();
          }
        } else {
          console.log("Não logado");
        }
      });
    });
  </script>
  <body>
    <div id="error" style="display: block;">
      <h1 style="color: #000000;">Servidor Desconectado</h1>
      <div>
        <p style="color: #000000;">Tente:</p>
        <ul>
          <li style="color: #000000;">
            Verificar os cabos de rede, modem e roteador
          </li>
          <li style="color: #000000;">Conectar à rede Wi-Fi novamente</li>
          <li style="color: #000000;">
            Executar o Diagnóstico de Rede do Windows
          </li>
        </ul>
      </div>
      <div style="color: #383535;">ERR_SERVER_DISCONNECTED</div>
    </div>
  </body>
</html>
